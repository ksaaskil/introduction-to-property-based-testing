<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>Introduction to property-based testing</title>
    <meta name="description" content="Introduction to property-based testing" />

    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/reveal.css" />
    <link rel="stylesheet" href="css/theme/matrix.css" />

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/monokai.css" />

    <!-- Printing and PDF exports -->
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section id="welcome">
          <header>
            <h3>Introduction to property-based testing</h3>
            </ul>
          </header>
          <p>
            Sources:
            <ul>
              <li>
                <a href="https://propertesting.com/">[1] Property-Based testing with PropEr, Erlang, and Elixir</a>
              </li>
              <li>
                <a href="https://pragprog.com/book/tpp20/the-pragmatic-programmer-20th-anniversary-edition" class="href">[2] Pragmatic Programmer, 20th anniversary edition</a>
              </li>
          </p>
        </section>
        <section id="example-based-tests">
          <h3>Example-based tests</h3>
            <ul>
              <li>
                Define examples of given input and expected output
              </li>
              <li>
                <u>Indirectly imply rules</u> dictating the behaviour of your code
              </li>
            </ul>
              <pre>
                <code class="language-python">
def test_mysort():
  l = [5, 3, 2, 1, 6]
  l_sorted = my_sort(l)
  assert l_sorted == [1, 2, 3, 5, 6]
                </code>
              </pre>
        </section>
        <section id="property-based-tests">
          <h3>Property-based tests</h3>
              Property-based testing (PBT) asks you to <u>come up with the rules first</u> and them tests them for you
              <pre>
                <code class="language-python">
from hypothesis import given
import hypothesis.strategies as some

@given(l=some.lists(some.integers()))
def test_my_sort(l):
    l_sorted = my_sort(l)
    assert len(l_sorted) == len(l)
    assert set(l_sorted) == set(l)
    for i in range(len(l) - 1):
        assert l_sorted[i] <= l_sorted[i+1]        
                </code>
              </pre>
        </section>
        <section id="why">
          <h3>Why property-based tests?</h3>
          <ul>
            <li>Exhaustively comb through your code</li>
            <li>Write more declarative tests instead of hard-coded examples</li>
            <li>Verify assumptions</li>
            <li>Test behaviour you could have never imagined</li>
          </ul>
        </section>
        <section id="examples">
          <h3>
            Examples
          </h3>
          <ul>
            <li>
              T. Arts found 25 important bugs from Project FIFO
              <ul>
                <li>460 lines of test code</li>
                <li>Covered 60 000 lines of code</li>
                <li>Timing errors, race conditions, type errors, errors in documentation,...</li>
              </ul>
              <li>
                J. W. Norton found sequences of 17 and 31 specific calls that could corrupt databases in Google's levelDB
              </li>
            </li>
          </ul>
        </section>
        <section id="why-not">
          <h3>
            Why not PBT?
          </h3>
          <ul>
            <li>Property-based tests <u>do not replace example-based tests</u></li>
            <li>Example-based tests are good, for example, for
              <ul>
                <li>
                  <u>Regression</u> tests
                </li>
                <li>
                  <u>Anchors</u> ensuring properties don't "drift"
                </li>
                <li>
                  <u>Human-readable examples</u> of input and output
                </li>
              </ul>
            </li>
            <li>Coming up with good properties can be hard and error-prone</li>
          </ul>
        </section>
        <section id="frameworks">
          <h3>Frameworks</h3>
          <ul>
            <li>
              <a href="https://hackage.haskell.org/package/QuickCheck" class="href">QuickCheck</a> (Haskell)
            </li>
            <li>
              <a href="https://github.com/dubzzz/fast-check" class="href">fast-check</a> (TypeScript)
            </li>
            <li>
              <a href="https://hypothesis.readthedocs.io/en/latest/" class="href">Hypothesis</a> (Python)
              <ul>
                <li>
                  Includes <a href="https://hypothesis.readthedocs.io/en/latest/numpy.html" class="href">NumPy and Pandas</a> tools!
                </li>
              </ul>
            </li>
            <li>
              <a href="https://proper-testing.github.io/" class="href">PropEr</a> (Erlang)
            </li>
            <li>
              <a href="https://github.com/alfert/propcheck" class="href">PropCheck</a> (Elixir)
            </li>
            <li>
              <a href="https://fscheck.github.io/FsCheck/" class="href">FsCheck</a> (.NET)
            </li>
          </ul>
        </section>
        <section id="concepts">
          <h3>Basic concepts</h3>
          <ul>
            <li>Properties</li>
            <li>Generators</li>
            <li>Shrinking (not discussed)</li>
          </ul>
        </section>

        <section id="coming-up">
          <h3>Coming up with properties</h3>
          <ul>
            <li>
              Modeling
            </li>
            <li>
              Invariants
            </li>
            <li>
              Symmetries
            </li>
            <li>
              Generalize example-based tests
              <ul>
                <li>
                  Replace hard-coded input values with generators
                </li>
              </ul>
            </li>
          </ul>
        </section>

        <section id="property-modeling">
          <h3>
            Modeling
          </h3>

          <pre>
            <code class="language-elixir">
property "finds biggest element" do
  forall x <- non_empty(list(integer())) do
    MyModule.biggest(x) == model_biggest(x)
  end
end

def model_biggest(x) do
  List.last(Enum.sort(list))
end
            </code>
          </pre>

        </section>

        <section id="property-symmetric">
          <h3>
            Symmetry
          </h3>

          <pre>
            <code class="language-elixir">
property "symmetric encoding/decoding" do
  forall data <- list({atom(), any()}) do
    encoded = encode(data)
    is_binary(encoded) and data == decode(encoded)
  end
end
            </code>
          </pre>

        </section>

        <section id="property-invariant">
          <h3>
            Invariance
          </h3>

          <pre>
            <code class="language-elixir">
property "a sorted list keeps its size" do
  forall l <- list(number()) do
    length(l) == length(MyModule.sort(l))
  end
end
            </code>
          </pre>
        </section>
        <section id="generators">
          <h3>Generators</h3>
          <ul>
            <li>
              Generators generate test data
            <ul>
              <li>
                Integers, booleans, lists, objects, <b>symbolic calls</b>, HTTP requests...
              </li>
            </ul>
            </li>
            <li>
              Generators are <b>composable</b>
              <ul>
                <li>Lists of integers, map with strings, symbolic calls with random arguments</li>
              </ul>
            </li>
            <li>
              Generators can be <b>resized</b>, <b>transformed</b>, and <b>restricted</b>
                <ul>
                  <li>Lists with more than one million values</li>
                  <li>List of HTTP requests where POST requests always precede GET requests</li>
                  <li>Only non-leap-day dates</li>
                </ul>
            </li>
          </ul>
        </section>
        <section id="statistics">
          <h3>Generator statistics</h3>
          <ul>
            <li>
              Very important to understand what is (not) being tested
              <ul>
            <li>
              <a href="https://hexdocs.pm/propcheck/PropCheck.html#collect/2">collect</a>, <a href="https://hexdocs.pm/propcheck/PropCheck.html#aggregate/2" class="href">aggregate</a>, <a href="https://hexdocs.pm/propcheck/PropCheck.html#measure/3" class="href">measure</a> in PropCheck
            </li>
              </ul>
              <li>Example output from <a href="https://hypothesis.readthedocs.io/en/latest/details.html#hypothesis.event">hypothesis.event</a>:
                <pre>
            <code>
  - Events:
    *  63.37%, input list length in range 0-5
    *  27.72%, input list length in range 5-10
    *   3.96%, input list length in range 10-15
    *   2.97%, input list length in range 15-20
    *   0.99%, input list length in range 35-40
            </code>
          </pre>
              </li>
          </ul>
          
        </section>
        <section id="demo">
          <h3>
            Demo
          </h3>
          Repository:
          <a href="https://github.com/ksaaskil/introduction-to-property-based-testing">
            ksaaskil/introduction-to-property-based-testing
          </a>
        </section>

        <section id="resources">
          <h3>
            Resources
          </h3>
          <ul>
            <li><a href="https://fsharpforfunandprofit.com/posts/property-based-testing-2/" class="href">Choosing properties for property-based testing</a></li>
          </ul>
        </section>

        <section id="acknowledgements">
          <h3>Acknowledgements</h3>
          <ul>
            <li>
              Slides created with
              <a href="https://revealjs.com/#/">Reveal.js</a>
            </li>
            <li>
              Color theme cloned from
              <a href="http://www.eclipsecolorthemes.org/?view=theme&id=467"
                >Matrix</a
              >
            </li>
          </ul>
        </section>
      </div>
    </div>

    <script src="js/reveal.js"></script>

    <script>
      // More info about config & dependencies:
      // - https://github.com/hakimel/reveal.js#configuration
      // - https://github.com/hakimel/reveal.js#dependencies
      Reveal.initialize({
        hash: true,
        transition: "none",
        dependencies: [
          { src: "plugin/markdown/marked.js" },
          { src: "plugin/markdown/markdown.js" },
          { src: "plugin/notes/notes.js", async: true },
          { src: "plugin/highlight/highlight.js", async: true },

          // Zoom in and out with Alt+click
          { src: "plugin/zoom-js/zoom.js", async: true },
        ],
      });
    </script>
  </body>
</html>
